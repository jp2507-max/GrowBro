# Security Hardening Tracker — 2025-11-09

| Category                    | Control                                         | Status   | Owner    | Date       | Evidence / Notes                                                                                                                                                                                                                                                                                                                                                                                             |
| --------------------------- | ----------------------------------------------- | -------- | -------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Authentication              | Short-lived JWTs with automatic refresh         | Verified | Security | 2025-11-09 | Supabase tokens expire after five minutes (`supabase/config.toml:2` and `supabase/config.toml:15`), and the root layout eagerly wires `useSessionAutoRefresh`/`useOfflineModeMonitor` so mobile clients always re-auth on short sessions (`src/app/_layout.tsx:138`).                                                                                                                                        |
| Authentication              | AAL2 step-up for destructive flows              | Verified | Security | 2025-11-09 | The `delete-account` Edge Function enforces `aal === '2'` on every request before it ever touches service-role clients (`supabase/functions/delete-account/index.ts:68`), and the paired RLS policies only allow MFA-elevated sessions to create or cancel account deletions (`supabase/migrations/20251109_enforce_aal2_and_content_report_policies.sql:15`).                                               |
| Authentication              | Deep-link allowlist & sanitization              | Verified | Security | 2025-11-09 | Redirects and auth hosts must match the explicit allowlist and sensitive query params are redacted before logging, preventing open redirects or token leaks (`src/lib/navigation/deep-link-allowlist.ts:15`).                                                                                                                                                                                                |
| Middleware / Edge Functions | Per-user rate limiting and uniform error schema | Verified | Security | 2025-11-09 | High-traffic endpoints such as `create-post` insist on a bearer token, enforce `withRateLimit`, and return structured 429 payloads (`supabase/functions/create-post/index.ts:90`); the shared middleware hits the `increment_rate_limit` RPC backed by the RLS-protected `rate_limits` table (`supabase/functions/_shared/rate-limit.ts:42`, `supabase/migrations/20251028_create_rate_limits_table.sql:8`). |
| Middleware / Edge Functions | Privileged workflows require server secrets     | Verified | Security | 2025-11-09 | Internal services such as `send-security-email` and `send-lockout-notification` check for service-role keys or HMAC-style shared secrets before touching data, and validate inputs before logging (`supabase/functions/send-security-email/index.ts:265`, `supabase/functions/send-lockout-notification/index.ts:28`).                                                                                       |
| Input Validation            | Media & text payload validation for posts       | Verified | Security | 2025-11-11 | `supabase/functions/create-post/index.ts:90-258` enforces POST-only requests, max 2K body length, and 50 MB media ceilings; remote media inputs are re-validated, resolved via DoH, and blocked if they point at private/loopback ranges (`supabase/functions/create-post/index.ts:300-520`), preventing SSRF/oversize uploads before any storage writes.                                                    |
| Sensitive Data              | Encrypted auth/session storage                  | Verified | Security | 2025-11-09 | The MMKV adapter persistently stores Supabase tokens only after generating a CSPRNG key and sealing it in the OS keychain/keystore, keeping secrets out of AsyncStorage (`src/lib/auth/auth-storage.ts:1`).                                                                                                                                                                                                  |
| Sensitive Data              | Session metadata capture without PII leakage    | Verified | Security | 2025-11-09 | `capture-device-metadata` validates the caller, truncates IPs before storage, and gates writes to the authenticated user’s session row (`supabase/functions/capture-device-metadata/index.ts:39` and `supabase/functions/capture-device-metadata/index.ts:116`).                                                                                                                                             |
| Sensitive Data              | Screenshots & background capture disabled       | Verified | Security | 2025-11-09 | Android disables backups and applies `FLAG_SECURE` at the activity level while iOS mirrors the protection via Expo’s screen-capture guard (`android/app/src/main/AndroidManifest.xml:17`, `android/app/src/main/java/com/jan_100/growbro/MainActivity.kt:16`, `src/app/_layout.tsx:141`).                                                                                                                    |
| Sensitive Data              | PII scrubbing before telemetry/export           | Verified | Security | 2025-11-09 | Sentry initialization is consent-aware and reuses `beforeSend`/`beforeBreadcrumb` hooks that redact emails, tokens, and network secrets before emission (`src/lib/performance/sentry-integration.ts:25`, `src/lib/sentry-utils.ts:5`).                                                                                                                                                                       |
| Storage                     | Private buckets & short-lived links             | Verified | Security | 2025-11-11 | `select id, public, file_size_limit, allowed_mime_types from storage.buckets` (2025-11-11) shows `avatars`, `community-posts`, `harvest-photos`, and `plant-images` stay private with enforced MIME/size controls, so clients must continue to rely on signed URLs before accessing objects.                                                                                                                 |
| Monitoring & Crypto Hygiene | Key rotation background enforcement             | Verified | Security | 2025-11-09 | The root layout registers the background fetch task that checks key expiry, and the task itself notifies users when MMKV keys near rotation windows (`src/app/_layout.tsx:141`, `src/lib/auth/key-rotation-task.ts:1`).                                                                                                                                                                                      |
| Infrastructure (Mobile)     | Certificate pinning & safety nets               | Verified | Security | 2025-11-09 | Pin domains/hashes are declared in the env set (`.env.production:68` & `.env.production:72`), Expo consumes them via the custom plugin, and runtime Axios interceptors refuse non-HTTPS or unpinned hosts unless explicit bypass flags are set (`app.config.cjs:229`, `src/lib/security/certificate-pinner.ts:1`, `src/lib/security/feature-flags.ts:33`).                                                   |
| Database Security           | Moderation & account tables RLS enforced        | Verified | Security | 2025-11-11 | Migration `supabase/migrations/20251109_enable_rls_sensitive_tables.sql` remains in place and `select relname, relrowsecurity, relforcerowsecurity …` (2025-11-11) confirms `users`, `user_roles`, `user_rate_limits`, `user_shadow_bans`, `user_suspensions`, `moderation_notifications`, `notifications`, and `action_executions` all still force RLS.                                                     |
| Database Security           | Auth lockouts & SLA telemetry protected         | Verified | Security | 2025-11-11 | Live query `select relname, relrowsecurity, relforcerowsecurity …` (2025-11-11) shows `auth_lockouts`, `sla_alerts`, and `sla_incidents` continue to enforce RLS exactly as codified in `supabase/migrations/20251109_enable_rls_sensitive_tables.sql`, so only elevated JWT roles or service-role contexts can read/write those operational tables.                                                         |
