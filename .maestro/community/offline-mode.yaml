appId: ${APP_ID}
env:
  EMAIL: 'test@growbro.app'
  PASSWORD: 'Test1234!'
---
# Community Feed - Offline Mode E2E Test
# Tests: Cached content display, action queuing, sync on reconnect

- launchApp
- runFlow: ../utils/onboarding-and-login.yaml

# Navigate to community and load feed
- tapOn:
    id: 'community-tab'
- assertVisible:
    id: 'community-screen'
- waitForAnimationToEnd

# Enable airplane mode
- runScript: |
    if [ "$MAESTRO_DRIVER_PLATFORM" = "ios" ]; then
      xcrun simctl status_bar booted override --dataNetwork wifi --wifiMode active --wifiBars 3
    else
      adb shell svc wifi disable && adb shell svc data disable
    fi

# Verify offline indicator appears
- waitForAnimationToEnd
- assertVisible:
    text: 'Offline'

# Verify cached posts are still visible
- assertVisible:
    id: 'post-card-*'

# Attempt to like a post (should queue action)
- tapOn:
    id: 'like-button-*'
- assertVisible: 'liked'

# Open post and attempt to comment
- tapOn:
    id: 'post-card-*'
- tapOn:
    id: 'comment-input'
- inputText: 'Queued comment while offline'
- tapOn:
    id: 'submit-comment-button'

# Verify comment shows pending state
- assertVisible: 'pending'

# Disable airplane mode
- runScript: |
    if [ "$MAESTRO_DRIVER_PLATFORM" = "ios" ]; then
      xcrun simctl status_bar booted clear
    else
      adb shell svc wifi enable && adb shell svc data enable
    fi

# Wait for sync to complete
- waitForAnimationToEnd:
    timeout: 5000

# Verify offline indicator disappears
- assertNotVisible:
    text: 'Offline'

# Verify queued actions are synced
- assertNotVisible: 'pending'
